From 228a56145ce06aa5e491c4579f59cd6c7e1107b1 Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Sun, 27 Oct 2024 14:22:50 +0100
Subject: [PATCH 10/10] arm64: dts: lx2160a-cex7: enable optee-os

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 .../boot/dts/freescale/fsl-lx2160a-cex7.dtsi  | 27 +++++++++++++++++++
 1 file changed, 27 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex7.dtsi b/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex7.dtsi
index feb6d02494df..024a119bcb7a 100644
--- a/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex7.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex7.dtsi
@@ -16,6 +16,33 @@ aliases {
 		crypto = &crypto;
 	};
 
+	firmware {
+		/*
+		 * This is counter-intuitive:
+		 *
+		 * U-Boot by default patches OS DTB adding /firmware/optee,
+		 * and updates /reserved-memory/optee.
+		 *
+		 * When OS DTB already has /firmware/optee node however,
+		 * U-Boot does nothing.
+		 *
+		 * Enable optee by deleting the /firmware/optee node.
+		 */
+		 /delete-node/ optee;
+	};
+
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+
+		optee@fc000000 {
+			reg = <0x00 0xfc000000 0x00 0x04000000>;
+			alignment = <0x200000>;
+			no-map;
+		};
+	};
+
 	sb_3v3: regulator-sb3v3 {
 		compatible = "regulator-fixed";
 		regulator-name = "RT7290";
-- 
2.43.0

