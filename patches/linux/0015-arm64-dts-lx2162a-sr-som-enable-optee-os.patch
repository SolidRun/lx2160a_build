From 61a2a998be708c6c865154f6308f1577fcf5d4ec Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Mon, 28 Oct 2024 17:09:55 +0100
Subject: [PATCH 15/15] arm64: dts: lx2162a-sr-som: enable optee-os

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 .../boot/dts/freescale/fsl-lx2162a-sr-som.dtsi  | 17 +++++++++++++++++
 1 file changed, 17 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-lx2162a-sr-som.dtsi b/arch/arm64/boot/dts/freescale/fsl-lx2162a-sr-som.dtsi
index e914291e63a1..fffdc517b583 100644
--- a/arch/arm64/boot/dts/freescale/fsl-lx2162a-sr-som.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-lx2162a-sr-som.dtsi
@@ -5,6 +5,23 @@
 // Copyright 2021 Rabeeh Khoury <rabeeh@solid-run.com>
 // Copyright 2023 Josua Mayer <josua@solid-run.com>
 
+/ {
+	firmware {
+		/*
+		 * This is counter-intuitive:
+		 *
+		 * U-Boot by default patches OS DTB adding /firmware/optee,
+		 * and updates /reserved-memory/optee.
+		 *
+		 * When OS DTB already has /firmware/optee node however,
+		 * U-Boot does nothing.
+		 *
+		 * Enable optee by deleting the /firmware/optee node.
+		 */
+		 /delete-node/ optee;
+	};
+};
+
 &crypto {
 	status = "okay";
 };
-- 
2.43.0

