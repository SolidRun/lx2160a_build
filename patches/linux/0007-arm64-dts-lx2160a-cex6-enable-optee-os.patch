From ac2f6e7fd725ea9bd4778d6294e564fd35cca06a Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Sun, 27 Oct 2024 14:21:17 +0100
Subject: [PATCH 07/21] arm64: dts: lx2160a-cex6: enable optee-os

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 .../boot/dts/freescale/fsl-lx2160a-cex6.dtsi  | 29 +++++++++++++++++++
 1 file changed, 29 insertions(+)

diff --git a/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex6.dtsi b/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex6.dtsi
index 1d97a25bc57f..c3174f0cab38 100644
--- a/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex6.dtsi
+++ b/arch/arm64/boot/dts/freescale/fsl-lx2160a-cex6.dtsi
@@ -4,6 +4,35 @@
 //
 // Copyright 2024 SolidRun Ltd.
 
+/ {
+	firmware {
+		/*
+		 * This is counter-intuitive:
+		 *
+		 * U-Boot by default patches OS DTB adding /firmware/optee,
+		 * and updates /reserved-memory/optee.
+		 *
+		 * When OS DTB already has /firmware/optee node however,
+		 * U-Boot does nothing.
+		 *
+		 * Enable optee by deleting the /firmware/optee node.
+		 */
+		 /delete-node/ optee;
+	};
+
+	reserved-memory {
+		#address-cells = <2>;
+		#size-cells = <2>;
+		ranges;
+
+		optee@fc000000 {
+			reg = <0x00 0xfc000000 0x00 0x04000000>;
+			alignment = <0x200000>;
+			no-map;
+		};
+	};
+};
+
 &crypto {
 	status = "okay";
 };
-- 
2.43.0

