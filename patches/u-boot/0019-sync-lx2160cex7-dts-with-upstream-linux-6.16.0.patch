From 5592a5b13b019b245970125ff079c996e0a43398 Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Wed, 6 Aug 2025 11:11:27 +0200
Subject: [PATCH 19/25] sync lx2160cex7 dts with upstream linux 6.16.0

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 arch/arm/dts/fsl-lx2160a-cex7-u-boot.dtsi | 37 ++++++++++++++++-------
 arch/arm/dts/fsl-lx2160a-cex7.dts         |  5 +--
 arch/arm/dts/fsl-lx2160a-cex7.dtsi        | 10 +-----
 3 files changed, 28 insertions(+), 24 deletions(-)

diff --git a/arch/arm/dts/fsl-lx2160a-cex7-u-boot.dtsi b/arch/arm/dts/fsl-lx2160a-cex7-u-boot.dtsi
index 5909af2b1b9..9394c36d70e 100644
--- a/arch/arm/dts/fsl-lx2160a-cex7-u-boot.dtsi
+++ b/arch/arm/dts/fsl-lx2160a-cex7-u-boot.dtsi
@@ -1,21 +1,36 @@
 // SPDX-License-Identifier: GPL-2.0+
 
+#include <dt-bindings/gpio/gpio.h>
+
 / {
 	aliases {
-		tlv0 = &com_eeprom;
+		tlv0 = &{/i2c@2000000/i2c-mux@77/i2c@0/eeprom@57};
+		serial0 = &uart0;
 	};
+};
 
-	fanctrl-override {
-		compatible = "solidrun,lx2160acex7-fanctrl-override";
-		override-gpios = <&gpio2 2 0>;
+&gpio2 {
+	/*
+	 * AMC6821 THERM signal uses open-drain logic and can be driven
+	 * by either the host (force full-speed) or the chip
+	 * (thermal warning). Firmware drives it low during reset.
+	 *
+	 * Force fan full-speed while bootloader is active.
+	 * TODO: Add fan-controller driver.
+	 */
+	fan-full-speed-hog {
+		gpio-hog;
+		gpios = <2 (GPIO_ACTIVE_LOW | GPIO_OPEN_DRAIN)>;
+		output-high;
+		line-name = "fan-full-speed";
 	};
 };
 
-&i2c0 {
-	/* for LX2162 SoM */
-	eeprom@57 {
-		compatible = "st,24c02", "atmel,24c02";
-		reg = <0x57>;
-		status = "disabled";
-	};
+&{/i2c@2000000/i2c-mux@77/i2c@1/fan-temperature-ctrlr@18} {
+	/*u-boot does not currently have a driver for this fan-controller */
+	status = "disabled";
+};
+
+&uart0 {
+	status = "okay";
 };
diff --git a/arch/arm/dts/fsl-lx2160a-cex7.dts b/arch/arm/dts/fsl-lx2160a-cex7.dts
index 60f99f143ce..3816034e279 100644
--- a/arch/arm/dts/fsl-lx2160a-cex7.dts
+++ b/arch/arm/dts/fsl-lx2160a-cex7.dts
@@ -7,10 +7,7 @@
 
 #include "fsl-lx2160a-cex7.dtsi"
 
-&dpmac17 {
-	status = "okay";
-};
-
+/* for SD-Card Boot */
 &esdhc0 {
 	sd-uhs-sdr104;
 	sd-uhs-sdr50;
diff --git a/arch/arm/dts/fsl-lx2160a-cex7.dtsi b/arch/arm/dts/fsl-lx2160a-cex7.dtsi
index 710087e7159..e4b72707081 100644
--- a/arch/arm/dts/fsl-lx2160a-cex7.dtsi
+++ b/arch/arm/dts/fsl-lx2160a-cex7.dtsi
@@ -14,7 +14,6 @@
 
 	aliases {
 		crypto = &crypto;
-		serial0 = &uart0;
 	};
 
 	sb_3v3: regulator-sb3v3 {
@@ -81,7 +80,7 @@
 				reg = <0x53>;
 			};
 
-			com_eeprom: eeprom@57 {
+			eeprom@57 {
 				compatible = "atmel,24c02";
 				reg = <0x57>;
 			};
@@ -95,9 +94,6 @@
 			fan-temperature-ctrlr@18 {
 				compatible = "ti,amc6821";
 				reg = <0x18>;
-				cooling-min-state = <0>;
-				cooling-max-state = <9>;
-				#cooling-cells = <2>;
 			};
 		};
 
@@ -179,10 +175,6 @@
 	};
 };
 
-&uart0 {
-	status = "okay";
-};
-
 &usb0 {
 	status = "okay";
 };
-- 
2.43.0

