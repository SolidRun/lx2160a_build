From 19067dac1cea330e12cf3594cf6ca2a7a3d257be Mon Sep 17 00:00:00 2001
From: Josua Mayer <josua@solid-run.com>
Date: Fri, 11 Oct 2024 16:39:12 +0200
Subject: [PATCH] add configuration solidrun internal lx2160a-cex6 evaluation
 board

Signed-off-by: Josua Mayer <josua@solid-run.com>
---
 lx2160acex6_rev2/Makefile                     |  1 +
 lx2160acex6_rev2/README                       |  0
 .../evb/rcw_2000_700_2900_3_3_2_auto.rcw      | 22 +++++
 lx2160acex6_rev2/include/common.rcwi          | 88 +++++++++++++++++++
 lx2160acex7/include/SD1_3.rcwi                | 27 ++++++
 lx2160acex7/include/SD2_3.rcwi                | 24 +++++
 6 files changed, 162 insertions(+)
 create mode 100644 lx2160acex6_rev2/Makefile
 create mode 100644 lx2160acex6_rev2/README
 create mode 100644 lx2160acex6_rev2/evb/rcw_2000_700_2900_3_3_2_auto.rcw
 create mode 100644 lx2160acex6_rev2/include/common.rcwi
 create mode 100644 lx2160acex7/include/SD1_3.rcwi
 create mode 100644 lx2160acex7/include/SD2_3.rcwi

diff --git a/lx2160acex6_rev2/Makefile b/lx2160acex6_rev2/Makefile
new file mode 100644
index 0000000..f77e46b
--- /dev/null
+++ b/lx2160acex6_rev2/Makefile
@@ -0,0 +1 @@
+include ../Makefile.inc
diff --git a/lx2160acex6_rev2/README b/lx2160acex6_rev2/README
new file mode 100644
index 0000000..e69de29
diff --git a/lx2160acex6_rev2/evb/rcw_2000_700_2900_3_3_2_auto.rcw b/lx2160acex6_rev2/evb/rcw_2000_700_2900_3_3_2_auto.rcw
new file mode 100644
index 0000000..8d14387
--- /dev/null
+++ b/lx2160acex6_rev2/evb/rcw_2000_700_2900_3_3_2_auto.rcw
@@ -0,0 +1,22 @@
+/*
+ * SerDes Protocol 1 -  3
+ * SerDes Protocol 2 -  3
+ * SerDes Protocol 3 -  2
+ *
+ * Frequencies:
+ * Core     -- 2000 MHz
+ * Platform -- 700  MHz
+ * DDR      -- 2900 MT/s
+ *
+ * Silicon 2.0
+ */
+
+#define LX_SR 2
+#include <../lx2160asi/lx2160a.rcwi>
+#include <../lx2160acex7/include/pll_2000_700_xxxx.rcwi>
+#include <../lx2160acex7/include/pll_xxxx_xxx_2900.rcwi>
+#include <../lx2160acex6_rev2/include/common.rcwi>
+#include <../lx2160acex7/include/SD1_3.rcwi>
+#include <../lx2160acex7/include/SD2_3.rcwi>
+#include <../lx2160acex7/include/SD3_2.rcwi>
+#include <../lx2160acex7/include/common_pbi.rcwi>
diff --git a/lx2160acex6_rev2/include/common.rcwi b/lx2160acex6_rev2/include/common.rcwi
new file mode 100644
index 0000000..8cc5ec7
--- /dev/null
+++ b/lx2160acex6_rev2/include/common.rcwi
@@ -0,0 +1,88 @@
+/*
+ * LX2160A COM-Express Type 6 Common Configuration
+ */
+
+/* C[5:8]_PLL are CG[5:8] div 1 */
+C5_PLL_SEL=0
+C6_PLL_SEL=0
+C7_PLL_SEL=0
+C8_PLL_SEL=0
+/* Cluster group A clock is PLL1 div 1 (unused on LX2160A) */
+HWA_CGA_M1_CLK_SEL=1
+/* Cluster group B clock is PLL2 div 2 (for DCE) */
+HWA_CGB_M1_CLK_SEL=6
+/*
+ * fall-back boot-mode when DCFG boot location pointer registers are null
+ * - 0b10101 (21): OCRAM
+ * - 0b11010 (26): XSPI
+ */
+BOOT_LOC=21
+/* SYSCLK is 100MHz */
+SYSCLK_FREQ=600
+/* USB-3.0 clock is 100MHz */
+USB3_CLK_FSEL=39
+
+/* IIC1 is I2C */
+IIC1_PMUX=0
+/* IIC2 is SD Card-Detect */
+IIC2_PMUX=6
+/* IIC3 is I2C */
+IIC3_PMUX=0
+/* IIC4 is I2C */
+IIC4_PMUX=0
+/* IIC5 SCL/SDA are SPI3_SOUT/SPI3_SIN */
+IIC5_PMUX=3
+/* IIC6 is PHY reset gpio */
+IIC6_PMUX=1
+/* SDHC1 CMD/CLK/DAT[0:3]/VSEL are SDHC1 CMD/CLK/DAT[0:3]/SPI3_PCS0 */
+SDHC1_BASE_PMUX=3
+/* SDHC1_DS is SPI3_SCK */
+SDHC1_DS_PMUX=2
+/* SDHC1_CMD_DIR (A4) / SDHC1_DAT0_DIR (B3) / SDHC1_DAT123_DIR (C3) are SPI3_PCS[1:3] */
+SDHC1_DIR_PMUX=3
+/* USB[1:2]_DRVVBUS/PWRFAULT are GPIO4[28:25] (unused) */
+USB_EXT_PMUX=1
+/* XSPI1_A_DQS/SCK/CS0_B/CS1_B are SPI */
+XSPI1_A_BASE_PMUX=0
+/* XSPI1_A_DATA[3:0] are SPI */
+XSPI1_A_DATA30_PMUX=0
+/* XSPI1_A_DATA[7:4] are SPI */
+XSPI1_A_DATA74_PMUX=0
+/* ASLEEP is ASLEEP (unused, bootstrap) */
+ASLEEP_PMUX=0
+/* EVT[2:0] are GPIO3[14:12] */
+EVT20_PMUX=1
+/* EVT[4:3] are GPIO3[16:15] */
+EVT43_PMUX=1
+/* CLK_OUT is GPIO (unused) */
+CLK_OUT_PMUX=1
+/* IRQ[3:0] are GPIO3[3:0] */
+IRQ03_00_PMUX=1
+/* IRQ[7:4] are GPIO3[7:4] */
+IRQ07_04_PMUX=1
+/* IRQ[11:8] are GPIO3[11:8] */
+IRQ11_08_PMUX=1
+/* EC1_* are RGMII */
+EC1_PMUX=0
+/* EC2_* are GPIO4[23:12] */
+EC2_PMUX=1
+/* EC_GTX_CLK125 is PTP */
+GTX_CLK_PMUX=0
+/* UART1_SOUT/SIN are UART1 */
+UART1_SOUTSIN_PMUX=0
+/* UART1_RTS/CTS_B are UART3_SOUT/SIN */
+UART1_RTSCTS_PMUX=2
+/* UART2_SOUT/SIN are UART2 */
+UART2_SOUTSIN_PMUX=0
+/* UART2_RTS/CTS_B are UART4_SOUT/SIN */
+UART2_RTSCTS_PMUX=2
+/* SDHC2_CMD/DAT[3:0]/DS/CLK are SDHC */
+SDHC2_BASE_PMUX=0
+/* SDHC2_DAT[7:4] are SDHC */
+SDHC2_DAT74_PMUX=0
+
+/*
+ * Original SolidRun Settings in LSDK-21.08
+ *
+ * HWA_CGB_M1_CLK_SEL=7 // Cluster Group B PLL 2 / 3 is clock
+ */
diff --git a/lx2160acex7/include/SD1_3.rcwi b/lx2160acex7/include/SD1_3.rcwi
new file mode 100644
index 0000000..a49adb3
--- /dev/null
+++ b/lx2160acex7/include/SD1_3.rcwi
@@ -0,0 +1,27 @@
+/*
+ * Serdes 1 Reference Clocks:
+ * - PLLF = 100MHz
+ * - PLLS = 161.1328125MHz
+ */
+
+/* Serdes 1 Protocol 3: 4x10Gbps + 1xPCI-e-x4 */
+SRDS_PRTCL_S1=3
+
+/* Enable Serdes 1 PLLF */
+SRDS_PLL_PD_PLL1=0
+
+/* Don't use Serdes 1 PLLF for PLLS */
+SRDS_INTRA_REF_CLK_S1=0
+
+/* Enable Serdes 1 PLLS */
+SRDS_PLL_PD_PLL2=0
+
+/*
+ * Select Serdes 1 PLLF frequency 100MHz for pcie: Bit 0 = 0
+ * Select Serdes 1 PLLS frequency 161.1328125MHz (not documented in RM) for usxgmii: Bit 1 = 1
+ * (See QorIQ LX2160A Reference Manual, Rev. 0, 07/2020, 4.9.8.9 Reset Control Word (RCW) Register Descriptions, Bits 932-933)
+ */
+SRDS_PLL_REF_CLK_SEL_S1=2
+
+/* Support up to PCI-e Gen 3 */
+SRDS_DIV_PEX_S1=1
diff --git a/lx2160acex7/include/SD2_3.rcwi b/lx2160acex7/include/SD2_3.rcwi
new file mode 100644
index 0000000..724ed9f
--- /dev/null
+++ b/lx2160acex7/include/SD2_3.rcwi
@@ -0,0 +1,24 @@
+/*
+ * Serdes 2 Reference Clocks:
+ * - PLLF = 100MHz
+ * - PLLS = 100MHz
+ */
+
+/* Serdes 2 Protocol 3: 2xPCI-e-x4 */
+SRDS_PRTCL_S2=3
+
+/* Enable Serdes 2 PLLF */
+SRDS_PLL_PD_PLL3=0
+
+/* Enable Serdes 2 PLLS */
+SRDS_PLL_PD_PLL4=0
+
+/* Don't use Serdes 2 PLLF for PLLS */
+SRDS_INTRA_REF_CLK_S2=0
+
+/*
+ * Select Serdes 2 PLLF frequency 100MHz (Bit 0)
+ * Select Serdes 2 PLLS frequency 100MHz (Bit 1)
+ * (See QorIQ LX2160A Reference Manual, Rev. 0, 07/2020, 4.9.8.9 Reset Control Word (RCW) Register Descriptions, Bits 932-933)
+ */
+SRDS_PLL_REF_CLK_SEL_S2=0
-- 
2.43.0

